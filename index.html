<!DOCTYPE html>
<html lang="zh-CN" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
<head>
		<meta charset="UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="profile" href="http://gmpg.org/xfn/11" />
	<link rel="pingback" href="/xmlrpc.php" />
	<title>Sanmao的幸福(?)生活</title>

<!-- SEO Ultimate (http://www.seodesignsolutions.com/wordpress-seo/) -->
	<link rel="author" href="https://plus.google.com/110741484037100884472/posts" />
	<meta property="og:type" content="blog" />
	<meta property="og:title" content="Sanmao的幸福(?)生活" />
	<meta property="og:description" content="Domino/Notes技术、Ubuntu、TV Game" />
	<meta property="og:url" content="http://blog.sanmaozhao.com/" />
	<meta property="og:site_name" content="Sanmao的幸福(?)生活" />
	<meta name="twitter:card" content="summary" />
<!-- /SEO Ultimate -->

<link rel='dns-prefetch' href='//fonts.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Sanmao的幸福(?)生活 &raquo; Feed" href="/feed" />
<link rel="alternate" type="application/rss+xml" title="Sanmao的幸福(?)生活 &raquo; 评论Feed" href="/comments/feed" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/12.0.0-1\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/12.0.0-1\/svg\/","svgExt":".svg","source":{"concatemoji":"\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.2.2"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55357,56424,55356,57342,8205,55358,56605,8205,55357,56424,55356,57340],[55357,56424,55356,57342,8203,55358,56605,8203,55357,56424,55356,57340]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='wp-block-library-css' href='/wp-includes/css/dist/block-library/style.min.css?ver=5.2.2' media='all' />
<link rel='stylesheet' id='parent-style-css' href='/wp-content/themes/flat/style.css?ver=5.2.2' media='all' />
<link rel='stylesheet' id='flat-style-css' href='/wp-content/themes/flat-my/style.css?ver=5.2.2' media='all' />
<link rel='stylesheet' id='flat_sky-child-style-css' href='/wp-content/themes/flat-my/style.css?ver=5.2.2' media='all' />
<link rel='stylesheet' id='flat-fonts-css' href='//fonts.googleapis.com/css?family=Amatic+SC%7CRoboto:400,700%7CRoboto+Slab%7CRoboto+Condensed' media='all' />
<link rel='stylesheet' id='flat-theme-css' href='/wp-content/themes/flat/assets/css/flat.min.css?ver=1.7.11' media='all' />
<script src='/wp-includes/js/jquery/jquery.js?ver=1.12.4-wp'></script>
<script src='/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script src='/wp-content/themes/flat/assets/js/flat.min.js?ver=1.7.11'></script>
<!--[if lt IE 9]>
<script src='http://blog.sanmaozhao.com/wp-content/themes/flat/assets/js/html5shiv.min.js?ver=3.7.2'></script>
<![endif]-->
<link rel='https://api.w.org/' href='/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.2.2" />
<style data-context="foundation-flickity-css">/*! Flickity v2.0.2
http://flickity.metafizzy.co
---------------------------------------------- */.flickity-enabled{position:relative}.flickity-enabled:focus{outline:0}.flickity-viewport{overflow:hidden;position:relative;height:100%}.flickity-slider{position:absolute;width:100%;height:100%}.flickity-enabled.is-draggable{-webkit-tap-highlight-color:transparent;tap-highlight-color:transparent;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.flickity-enabled.is-draggable .flickity-viewport{cursor:move;cursor:-webkit-grab;cursor:grab}.flickity-enabled.is-draggable .flickity-viewport.is-pointer-down{cursor:-webkit-grabbing;cursor:grabbing}.flickity-prev-next-button{position:absolute;top:50%;width:44px;height:44px;border:none;border-radius:50%;background:#fff;background:hsla(0,0%,100%,.75);cursor:pointer;-webkit-transform:translateY(-50%);transform:translateY(-50%)}.flickity-prev-next-button:hover{background:#fff}.flickity-prev-next-button:focus{outline:0;box-shadow:0 0 0 5px #09f}.flickity-prev-next-button:active{opacity:.6}.flickity-prev-next-button.previous{left:10px}.flickity-prev-next-button.next{right:10px}.flickity-rtl .flickity-prev-next-button.previous{left:auto;right:10px}.flickity-rtl .flickity-prev-next-button.next{right:auto;left:10px}.flickity-prev-next-button:disabled{opacity:.3;cursor:auto}.flickity-prev-next-button svg{position:absolute;left:20%;top:20%;width:60%;height:60%}.flickity-prev-next-button .arrow{fill:#333}.flickity-page-dots{position:absolute;width:100%;bottom:-25px;padding:0;margin:0;list-style:none;text-align:center;line-height:1}.flickity-rtl .flickity-page-dots{direction:rtl}.flickity-page-dots .dot{display:inline-block;width:10px;height:10px;margin:0 8px;background:#333;border-radius:50%;opacity:.25;cursor:pointer}.flickity-page-dots .dot.is-selected{opacity:1}</style><style data-context="foundation-slideout-css">.slideout-menu{position:fixed;left:0;top:0;bottom:0;right:auto;z-index:0;width:256px;overflow-y:auto;-webkit-overflow-scrolling:touch;display:none}.slideout-menu.pushit-right{left:auto;right:0}.slideout-panel{position:relative;z-index:1;will-change:transform}.slideout-open,.slideout-open .slideout-panel,.slideout-open body{overflow:hidden}.slideout-open .slideout-menu{display:block}.pushit{display:none}</style><style type="text/css"></style><style type="text/css">#masthead .site-title {font-family:Amatic SC}body {font-family:Roboto }h1,h2,h3,h4,h5,h6 {font-family:Roboto Slab}#masthead .site-description, .hentry .entry-meta {font-family:Roboto Condensed}</style><style type="text/css" id="custom-background-css">
body.custom-background { background-image: url("/wp-content/themes/flat-my/assets/img/default-background.jpg"); background-position: left top; background-size: auto; background-repeat: repeat; background-attachment: scroll; }
</style>
	
	<!-- Clean Archives Reloaded v3.2.0 | http://www.viper007bond.com/wordpress-plugins/clean-archives-reloaded/ -->
	<style type="text/css">.car-collapse .car-yearmonth { cursor: s-resize; } </style>
	<script type="text/javascript">
		/* <![CDATA[ */
			jQuery(document).ready(function() {
				jQuery('.car-collapse').find('.car-monthlisting').hide();
				jQuery('.car-collapse').find('.car-monthlisting:first').show();
				jQuery('.car-collapse').find('.car-yearmonth').click(function() {
					jQuery(this).next('ul').slideToggle('fast');
				});
				jQuery('.car-collapse').find('.car-toggler').click(function() {
					if ( '展开所有月份' == jQuery(this).text() ) {
						jQuery(this).parent('.car-container').find('.car-monthlisting').show();
						jQuery(this).text('折叠所有月份');
					}
					else {
						jQuery(this).parent('.car-container').find('.car-monthlisting').hide();
						jQuery(this).text('展开所有月份');
					}
					return false;
				});
			});
		/* ]]> */
	</script>

<style>.ios7.web-app-mode.has-fixed header{ background-color: rgba(45,53,63,.88);}</style>	</head>

<body class="home blog custom-background" itemscope itemtype="http://schema.org/WebPage">
<div id="page">
	<div class="container">
		<div class="row row-offcanvas row-offcanvas-left">
			<div id="secondary" class="col-lg-3">
								<header id="masthead" class="site-header" role="banner">
										<div class="hgroup">
						<h1 class="site-title display-title"><a href="/" title="Sanmao的幸福(?)生活" rel="home"><span itemprop="name">Sanmao的幸福(?)生活</span></a></h1><h2 itemprop="description" class="site-description">Domino/Notes技术、Ubuntu、TV Game</h2>					</div>
					<button type="button" class="btn btn-link hidden-lg toggle-sidebar" data-toggle="offcanvas" aria-label="Sidebar"><i class="fa fa-gear"></i></button>
					<button type="button" class="btn btn-link hidden-lg toggle-navigation" aria-label="Navigation Menu"><i class="fa fa-bars"></i></button>
					<nav id="site-navigation" class="navigation main-navigation" role="navigation">
						<div class="nav-menu"><ul>
<li class="page_item page-item-424593 current_page_parent"><a href="/article_list">文章列表</a></li>
</ul></div>
					</nav>
									</header>
				
				<div class="sidebar-offcanvas">
					<div id="main-sidebar" class="widget-area" role="complementary">
											<aside id="search-3" class="widget widget_search">
	<form method="get" id="searchform" action="https://www.bing.com/search">
		<label for="s" class="assistive-text">搜索</label>
		<input type="text" class="field" name="q" id="s" placeholder="搜索" />
		<input type="hidden" class="field" name="q1" id="s" value="site:blog.sanmaozhao.com" />
		<input type="submit" class="submit" name="submit" id="searchsubmit" value="搜索" />
	</form>
					</aside>
					<aside id="text-4" class="widget widget_text">
						<h3 class='widget-title'>尊重原创：关于转载</h3>
			<div class="textwidget">我希望在中文环境中建立一种健康的 TrackBack 和链接机制，保证原创，并不影响传播。因此欢迎您在网站上推荐我的文章，包括文字和图片片段，但不赞成任何形式的全文转载。若需全文转载，请您征得我的同意，并添加本站原文链接，标明所有的引用、参考信息和图片版权来源。</div><h4 class="widget-title">联系我：sanmaozhao at gmail.com</h4>
							</aside>
					<aside id="categories-4" class="widget widget_categories">
						<h3 class='widget-title'>分类目录</h3>
		<ul>
				<li class="cat-item cat-item-3"><a href="/articles/category/dojo">Dojo</a> (3)
</li>
	<li class="cat-item cat-item-84"><a href="/articles/category/dominonotes">Domino/Notes</a> (149)
<ul class='children'>
	<li class="cat-item cat-item-109"><a href="/articles/category/dominonotes/xpages">XPages</a> (7)
</li>
</ul>
</li>
	<li class="cat-item cat-item-5"><a href="/articles/category/tv-game">TV Game</a> (10)
</li>
	<li class="cat-item cat-item-85"><a href="/articles/category/ubuntulinux" title="Ubuntu/Linux">Ubuntu/Linux</a> (6)
</li>
	<li class="cat-item cat-item-86"><a href="/articles/category/web">Web技术</a> (14)
</li>
	<li class="cat-item cat-item-87"><a href="/articles/category/%e5%85%b6%e4%bb%96">其他</a> (9)
</li>
	<li class="cat-item cat-item-1"><a href="/articles/category/%e6%9c%aa%e5%88%86%e7%b1%bb">未分类</a> (1)
</li>
		</ul>
								</aside>
					<aside id="archives-4" class="widget widget_archive">
						<h3 class='widget-title'>文章归档</h3>
		<label class="screen-reader-text" for="archives-dropdown-4">文章归档</label>
		<select id="archives-dropdown-4" name="archive-dropdown">
			
			<option value="">选择月份</option>
				<option value='/articles/2016/12'> 2016年十二月 &nbsp;(1)</option>
	<option value='/articles/2016/11'> 2016年十一月 &nbsp;(1)</option>
	<option value='/articles/2015/06'> 2015年六月 &nbsp;(1)</option>
	<option value='/articles/2015/01'> 2015年一月 &nbsp;(1)</option>
	<option value='/articles/2014/12'> 2014年十二月 &nbsp;(1)</option>
	<option value='/articles/2014/09'> 2014年九月 &nbsp;(1)</option>
	<option value='/articles/2014/07'> 2014年七月 &nbsp;(1)</option>
	<option value='/articles/2013/11'> 2013年十一月 &nbsp;(1)</option>
	<option value='/articles/2013/10'> 2013年十月 &nbsp;(1)</option>
	<option value='/articles/2013/05'> 2013年五月 &nbsp;(2)</option>
	<option value='/articles/2013/04'> 2013年四月 &nbsp;(2)</option>
	<option value='/articles/2013/03'> 2013年三月 &nbsp;(1)</option>
	<option value='/articles/2012/10'> 2012年十月 &nbsp;(2)</option>
	<option value='/articles/2012/08'> 2012年八月 &nbsp;(1)</option>
	<option value='/articles/2012/07'> 2012年七月 &nbsp;(2)</option>
	<option value='/articles/2012/06'> 2012年六月 &nbsp;(3)</option>
	<option value='/articles/2012/04'> 2012年四月 &nbsp;(1)</option>
	<option value='/articles/2012/03'> 2012年三月 &nbsp;(1)</option>
	<option value='/articles/2012/02'> 2012年二月 &nbsp;(1)</option>
	<option value='/articles/2011/12'> 2011年十二月 &nbsp;(1)</option>
	<option value='/articles/2011/11'> 2011年十一月 &nbsp;(2)</option>
	<option value='/articles/2011/10'> 2011年十月 &nbsp;(1)</option>
	<option value='/articles/2011/08'> 2011年八月 &nbsp;(2)</option>
	<option value='/articles/2011/07'> 2011年七月 &nbsp;(3)</option>
	<option value='/articles/2011/05'> 2011年五月 &nbsp;(2)</option>
	<option value='/articles/2011/04'> 2011年四月 &nbsp;(1)</option>
	<option value='/articles/2011/03'> 2011年三月 &nbsp;(3)</option>
	<option value='/articles/2010/12'> 2010年十二月 &nbsp;(4)</option>
	<option value='/articles/2010/09'> 2010年九月 &nbsp;(2)</option>
	<option value='/articles/2010/08'> 2010年八月 &nbsp;(2)</option>
	<option value='/articles/2010/07'> 2010年七月 &nbsp;(3)</option>
	<option value='/articles/2010/06'> 2010年六月 &nbsp;(1)</option>
	<option value='/articles/2010/05'> 2010年五月 &nbsp;(5)</option>
	<option value='/articles/2010/03'> 2010年三月 &nbsp;(7)</option>
	<option value='/articles/2010/02'> 2010年二月 &nbsp;(2)</option>
	<option value='/articles/2009/12'> 2009年十二月 &nbsp;(1)</option>
	<option value='/articles/2009/10'> 2009年十月 &nbsp;(2)</option>
	<option value='/articles/2009/09'> 2009年九月 &nbsp;(1)</option>
	<option value='/articles/2009/07'> 2009年七月 &nbsp;(2)</option>
	<option value='/articles/2009/06'> 2009年六月 &nbsp;(1)</option>
	<option value='/articles/2009/04'> 2009年四月 &nbsp;(5)</option>
	<option value='/articles/2009/03'> 2009年三月 &nbsp;(2)</option>
	<option value='/articles/2009/01'> 2009年一月 &nbsp;(3)</option>
	<option value='/articles/2008/10'> 2008年十月 &nbsp;(2)</option>
	<option value='/articles/2008/08'> 2008年八月 &nbsp;(3)</option>
	<option value='/articles/2008/07'> 2008年七月 &nbsp;(1)</option>
	<option value='/articles/2008/06'> 2008年六月 &nbsp;(1)</option>
	<option value='/articles/2008/05'> 2008年五月 &nbsp;(3)</option>
	<option value='/articles/2008/03'> 2008年三月 &nbsp;(2)</option>
	<option value='/articles/2008/02'> 2008年二月 &nbsp;(2)</option>
	<option value='/articles/2008/01'> 2008年一月 &nbsp;(5)</option>
	<option value='/articles/2007/12'> 2007年十二月 &nbsp;(1)</option>
	<option value='/articles/2007/11'> 2007年十一月 &nbsp;(2)</option>
	<option value='/articles/2007/10'> 2007年十月 &nbsp;(3)</option>
	<option value='/articles/2007/09'> 2007年九月 &nbsp;(8)</option>
	<option value='/articles/2007/08'> 2007年八月 &nbsp;(1)</option>
	<option value='/articles/2007/07'> 2007年七月 &nbsp;(14)</option>
	<option value='/articles/2007/06'> 2007年六月 &nbsp;(3)</option>
	<option value='/articles/2007/05'> 2007年五月 &nbsp;(2)</option>
	<option value='/articles/2007/04'> 2007年四月 &nbsp;(2)</option>
	<option value='/articles/2007/03'> 2007年三月 &nbsp;(2)</option>
	<option value='/articles/2007/01'> 2007年一月 &nbsp;(1)</option>
	<option value='/articles/2006/10'> 2006年十月 &nbsp;(3)</option>
	<option value='/articles/2006/09'> 2006年九月 &nbsp;(1)</option>
	<option value='/articles/2006/08'> 2006年八月 &nbsp;(3)</option>
	<option value='/articles/2006/07'> 2006年七月 &nbsp;(3)</option>
	<option value='/articles/2006/06'> 2006年六月 &nbsp;(4)</option>
	<option value='/articles/2006/05'> 2006年五月 &nbsp;(1)</option>
	<option value='/articles/2006/04'> 2006年四月 &nbsp;(7)</option>
	<option value='/articles/2006/01'> 2006年一月 &nbsp;(1)</option>
	<option value='/articles/2005/12'> 2005年十二月 &nbsp;(4)</option>
	<option value='/articles/2005/11'> 2005年十一月 &nbsp;(3)</option>
	<option value='/articles/2005/09'> 2005年九月 &nbsp;(2)</option>
	<option value='/articles/2005/08'> 2005年八月 &nbsp;(2)</option>
	<option value='/articles/2005/07'> 2005年七月 &nbsp;(10)</option>

		</select>

<script type='text/javascript'>
/* <![CDATA[ */
(function() {
	var dropdown = document.getElementById( "archives-dropdown-4" );
	function onSelectChange() {
		if ( dropdown.options[ dropdown.selectedIndex ].value !== '' ) {
			document.location.href = this.options[ this.selectedIndex ].value;
		}
	}
	dropdown.onchange = onSelectChange;
})();
/* ]]> */
</script>

							</aside>
					<aside id="tag_cloud-4" class="widget widget_tag_cloud">
						<h3 class='widget-title'>标签</h3>
<div class="tagcloud"><a href="/articles/tag/agent" class="tag-cloud-link tag-link-88 tag-link-position-1" style="font-size: 10.377358490566pt;" aria-label="agent (2个项目)">agent</a>
<a href="/articles/tag/alloy" class="tag-cloud-link tag-link-10 tag-link-position-2" style="font-size: 8pt;" aria-label="alloy (1个项目)">alloy</a>
<a href="/articles/tag/base64" class="tag-cloud-link tag-link-60 tag-link-position-3" style="font-size: 10.377358490566pt;" aria-label="base64 (2个项目)">base64</a>
<a href="/articles/tag/bug" class="tag-cloud-link tag-link-11 tag-link-position-4" style="font-size: 11.962264150943pt;" aria-label="bug (3个项目)">bug</a>
<a href="/articles/tag/build" class="tag-cloud-link tag-link-12 tag-link-position-5" style="font-size: 8pt;" aria-label="build (1个项目)">build</a>
<a href="/articles/tag/capi" class="tag-cloud-link tag-link-13 tag-link-position-6" style="font-size: 11.962264150943pt;" aria-label="capi (3个项目)">capi</a>
<a href="/articles/tag/charset" class="tag-cloud-link tag-link-61 tag-link-position-7" style="font-size: 10.377358490566pt;" aria-label="charset (2个项目)">charset</a>
<a href="/articles/tag/column" class="tag-cloud-link tag-link-14 tag-link-position-8" style="font-size: 8pt;" aria-label="column (1个项目)">column</a>
<a href="/articles/tag/conflict" class="tag-cloud-link tag-link-89 tag-link-position-9" style="font-size: 10.377358490566pt;" aria-label="conflict (2个项目)">conflict</a>
<a href="/articles/tag/css" class="tag-cloud-link tag-link-65 tag-link-position-10" style="font-size: 10.377358490566pt;" aria-label="css (2个项目)">css</a>
<a href="/articles/tag/custom" class="tag-cloud-link tag-link-15 tag-link-position-11" style="font-size: 8pt;" aria-label="custom (1个项目)">custom</a>
<a href="/articles/tag/dblookup" class="tag-cloud-link tag-link-16 tag-link-position-12" style="font-size: 10.377358490566pt;" aria-label="dblookup (2个项目)">dblookup</a>
<a href="/articles/tag/dct" class="tag-cloud-link tag-link-17 tag-link-position-13" style="font-size: 8pt;" aria-label="dct (1个项目)">dct</a>
<a href="/articles/tag/delay" class="tag-cloud-link tag-link-18 tag-link-position-14" style="font-size: 8pt;" aria-label="delay (1个项目)">delay</a>
<a href="/articles/tag/dijit" class="tag-cloud-link tag-link-19 tag-link-position-15" style="font-size: 8pt;" aria-label="dijit (1个项目)">dijit</a>
<a href="/articles/tag/dojo" class="tag-cloud-link tag-link-115 tag-link-position-16" style="font-size: 10.377358490566pt;" aria-label="Dojo (2个项目)">Dojo</a>
<a href="/articles/tag/domino" class="tag-cloud-link tag-link-20 tag-link-position-17" style="font-size: 14.339622641509pt;" aria-label="domino (5个项目)">domino</a>
<a href="/articles/tag/domino-server-setup" class="tag-cloud-link tag-link-21 tag-link-position-18" style="font-size: 8pt;" aria-label="domino server setup (1个项目)">domino server setup</a>
<a href="/articles/tag/formula" class="tag-cloud-link tag-link-25 tag-link-position-19" style="font-size: 16.584905660377pt;" aria-label="formula (8个项目)">formula</a>
<a href="/articles/tag/ftsearch" class="tag-cloud-link tag-link-27 tag-link-position-20" style="font-size: 11.962264150943pt;" aria-label="ftsearch (3个项目)">ftsearch</a>
<a href="/articles/tag/guitar-hero" class="tag-cloud-link tag-link-74 tag-link-position-21" style="font-size: 14.339622641509pt;" aria-label="guitar hero (5个项目)">guitar hero</a>
<a href="/articles/tag/java" class="tag-cloud-link tag-link-96 tag-link-position-22" style="font-size: 10.377358490566pt;" aria-label="java (2个项目)">java</a>
<a href="/articles/tag/javascript" class="tag-cloud-link tag-link-62 tag-link-position-23" style="font-size: 14.339622641509pt;" aria-label="javascript (5个项目)">javascript</a>
<a href="/articles/tag/jsf" class="tag-cloud-link tag-link-110 tag-link-position-24" style="font-size: 8pt;" aria-label="jsf (1个项目)">jsf</a>
<a href="/articles/tag/lotusscript" class="tag-cloud-link tag-link-33 tag-link-position-25" style="font-size: 20.283018867925pt;" aria-label="lotusscript (16个项目)">lotusscript</a>
<a href="/articles/tag/mail" class="tag-cloud-link tag-link-36 tag-link-position-26" style="font-size: 11.962264150943pt;" aria-label="mail (3个项目)">mail</a>
<a href="/articles/tag/nd7" class="tag-cloud-link tag-link-69 tag-link-position-27" style="font-size: 10.377358490566pt;" aria-label="nd7 (2个项目)">nd7</a>
<a href="/articles/tag/nd9" class="tag-cloud-link tag-link-112 tag-link-position-28" style="font-size: 10.377358490566pt;" aria-label="nd9 (2个项目)">nd9</a>
<a href="/articles/tag/nd85" class="tag-cloud-link tag-link-41 tag-link-position-29" style="font-size: 15.264150943396pt;" aria-label="nd85 (6个项目)">nd85</a>
<a href="/articles/tag/nd702" class="tag-cloud-link tag-link-73 tag-link-position-30" style="font-size: 10.377358490566pt;" aria-label="nd702 (2个项目)">nd702</a>
<a href="/articles/tag/nd801" class="tag-cloud-link tag-link-39 tag-link-position-31" style="font-size: 10.377358490566pt;" aria-label="nd801 (2个项目)">nd801</a>
<a href="/articles/tag/nd802" class="tag-cloud-link tag-link-40 tag-link-position-32" style="font-size: 10.377358490566pt;" aria-label="nd802 (2个项目)">nd802</a>
<a href="/articles/tag/nd851" class="tag-cloud-link tag-link-42 tag-link-position-33" style="font-size: 10.377358490566pt;" aria-label="nd851 (2个项目)">nd851</a>
<a href="/articles/tag/nd852" class="tag-cloud-link tag-link-101 tag-link-position-34" style="font-size: 16.584905660377pt;" aria-label="nd852 (8个项目)">nd852</a>
<a href="/articles/tag/nd853" class="tag-cloud-link tag-link-108 tag-link-position-35" style="font-size: 13.283018867925pt;" aria-label="nd853 (4个项目)">nd853</a>
<a href="/articles/tag/notes-ini" class="tag-cloud-link tag-link-44 tag-link-position-36" style="font-size: 22pt;" aria-label="notes.ini (22个项目)">notes.ini</a>
<a href="/articles/tag/nsd" class="tag-cloud-link tag-link-102 tag-link-position-37" style="font-size: 10.377358490566pt;" aria-label="nsd (2个项目)">nsd</a>
<a href="/articles/tag/password" class="tag-cloud-link tag-link-46 tag-link-position-38" style="font-size: 10.377358490566pt;" aria-label="password (2个项目)">password</a>
<a href="/articles/tag/performance" class="tag-cloud-link tag-link-71 tag-link-position-39" style="font-size: 15.264150943396pt;" aria-label="performance (6个项目)">performance</a>
<a href="/articles/tag/release" class="tag-cloud-link tag-link-49 tag-link-position-40" style="font-size: 10.377358490566pt;" aria-label="release (2个项目)">release</a>
<a href="/articles/tag/replica" class="tag-cloud-link tag-link-75 tag-link-position-41" style="font-size: 10.377358490566pt;" aria-label="replica (2个项目)">replica</a>
<a href="/articles/tag/sap" class="tag-cloud-link tag-link-51 tag-link-position-42" style="font-size: 10.377358490566pt;" aria-label="sap (2个项目)">sap</a>
<a href="/articles/tag/search" class="tag-cloud-link tag-link-52 tag-link-position-43" style="font-size: 10.377358490566pt;" aria-label="search (2个项目)">search</a>
<a href="/articles/tag/unid" class="tag-cloud-link tag-link-56 tag-link-position-44" style="font-size: 10.377358490566pt;" aria-label="unid (2个项目)">unid</a>
<a href="/articles/tag/xpage" class="tag-cloud-link tag-link-107 tag-link-position-45" style="font-size: 11.962264150943pt;" aria-label="xpage (3个项目)">xpage</a></div>
					</aside>
					<aside id="linkcat-2" class="widget widget_links">
						<h3 class='widget-title'>链接表</h3>

	<ul class='xoxo blogroll'>
<li><a href="http://www-10.lotus.com/ldd/ddwiki.nsf" title="Lotus Notes and Domino Application Development wiki" target="_blank">LDD wiki</a></li>
<li><a href="http://www-947.ibm.com/support/entry/portal/Overview/Software/Lotus/Lotus_Domino" target="_blank">Lotus Domino Support Portal</a></li>
<li><a href="https://www.ibm.com/developerworks/lotus/community/" target="_blank">Lotus Forums and community</a></li>
<li><a href="http://wanglaoban.org/" rel="friend" target="_blank">王老板</a></li>

	</ul>
					</aside>

											</div>
				</div>
			</div>

						<div id="primary" class="content-area col-lg-9" itemprop="mainContentOfPage">
						<div id="content" class="site-content" role="main">
		
						<article itemscope itemtype="http://schema.org/Article" id="post-645332" class="post-645332 post type-post status-publish format-standard hentry category-dominonotes tag-ls2c tag-lsx">
	<header class="entry-header">
		<h2 class="entry-title" itemprop="name">
			<a itemprop="url" href="/articles/extending-lotusscript.html" title="链向扩展 LotusScript 的能力的固定链接" rel="bookmark">扩展 LotusScript 的能力</a>
		</h2>
							<div class="entry-meta"><span class="entry-date"><a href="/articles/extending-lotusscript.html" rel="bookmark"><time class="entry-date published" datetime="2016-12-27T13:50:36+08:00" itemprop="datepublished">2016年12月27日</time></a></span> by <span class="author vcard" itemscope itemprop="author" itemtype="http://schema.org/Person"><a class="url fn n" href="/articles/author/admin" rel="author" itemprop="url"><span itemprop="name">Sanmao</span></a></span><span class="sep">&middot;</span><span class="comments-link"><a href="/articles/extending-lotusscript.html#comments" itemprop="discussionUrl">3条评论</a></span></div>
			</header>
								<div class="entry-content" itemprop="articleBody">
						<h3>需求</h3>
<p>LotusScript 最近的更新是版本 7/8 时增加的 WebService 调用者、提供者，这已经是快十年前的事情了。现在 LotusScript 已经明显落后，欠缺的大量基础能力：JSON 解析器、跨代理的数据缓存、HTTP Client、完善的面向对象机制、将函数作为参数传递……这严重制约了应用层面的开发。</p>
<p>IBM 对此问题的应对是推出 XPages，一种新的开发模式。XPages 确实是一个不错的东西，展现和数据分离、內置 Ajax 框架……但是，作为应用开发商我们无法抛弃历史资产一切推倒重来。所以 XPages 我们只能用来做一些新的业务、功能点，对于原有的业务还是要继续在 LotusScript 上发展。</p>
<p>所以我们必须自己来扩展 LotusScript 的能力。</p>
<h3>方案</h3>
<h4>LotusScript 类、函数库</h4>
<p>首先想到的就是直接用 LotusScript 来实现，但这只能解决一部分问题：比如 JSON 解析器。而类似于 HTTP Client 这种，LotusScript 就无能为力了。</p>
<p>我们也确实做了一版 LotusScript 的 JSON 解析器，但是性能实在是太差了：由于需要一个字符一个字符的解析，最终导致一个 15K 的 JSON 串解析出来要花 0.5 秒。结果我们又废弃了它，重新回到手工拆解字符串的老路上。</p>
<p>此路不通。</p>
<h4>LSX（LotusScript eXtension）</h4>
<p>这是最正统的扩展 LotusScript 的方式（看看名字就知道），实际上我们使用的 NotesDocument 等 Domino 后台对象都是用这种方式扩展出来的。实际的 C 代码编译成共享库，位于 nlsxbe.dll（<strong>n</strong>=windows平台前缀,<strong>lsx,be=</strong>Back-end）中，LotusScript 引擎会自动加载它，所以我们不用再通过 <strong>USELSX lsxbe</strong> 来手工加载。</p>
<p>LSX 的优点有很多：跨平台、与 LotusScript 无缝集成……</p>
<p>但是，LSX 现在已经处于一个半废弃的状态。为什么这么说呢，LSX 最新版 8.0 于 2009 年发布，再往前一版就是 1999 年了。所以即使是最新版也缺少了很多内容：xlinux 64 位的支持等。</p>
<p>此路不通。</p>
<h4>LS2C（LotusScript to C API）</h4>
<p>这是一个比较成熟、<a href="http://www.nsftools.com/tips/APITips.htm" target="_blank" rel="noopener">使用较多的方案</a>。一般都用于在 LotusScript 中调用底层的 C API（例如隐藏设计、重新编译所有代码），因为这些 API 没有暴露到 LotusScript 这一层。</p>
<p>LS2C 与 LSX 相比会多一些限制，比如：</p>
<ul>
<li>只能传递数值、字符串等基础类型，无法传递 NotesDocuemnt</li>
<li>不支持 LotusScript 扩展语法（doc.itemName 这种）</li>
</ul>
<p>但这个方案至少在持续的更新，而且 C 这个层面不需要使用 Lotus 的开发工具包，用任何编译器生成标准的共享库即可。</p>
<p>我们最终采用了此方案。</p>
<h3>经验总结</h3>
<h4>变长字符串</h4>
<p>C 语言中不支持变长字符串，所以我们在返回变长字符串时，实际返回的是一个 handle 值；这个 handle 值再通过另一个 API 获取实际的字符串（类似于 NSFDbOpen 返回的 handle）。</p>
<p>handle 用完之后要注意释放（类似于 NSFDbClose）。</p>
<h4>中文的处理</h4>
<p>LS2C 的字符串参数传递有三种声明方式：</p>
<ol>
<li>arg As String<br />
采用操作系统本地的编码方式，windows 一般为 GBK，linux 一般为 UTF-8。不同系统编码不同，不利于统一处理</li>
<li>arg As LMBCS String<br />
不管操作系统本地的编码方式，统一采用 <a href="/articles/character-encoding-in-domino.html" target="_blank" rel="noopener">LMBCS</a>。这种编码方式适用范围太小，仅 Lotus 自己的产品线</li>
<li>arg As Unicode String<br />
不管操作系统本地的编码方式，统一采用 UTF-16。推荐使用此方式，对环境的适应性更好。<br />
但要注意 UTF-16 英文也用双字节存储，C 语言中会把其中的 0x00 识别为字符串结束。所以进入到 C 代码内部后，可以转为 UTF-8 存储。<br />
还要注意不同硬件下字节序的问题，x64 和 Power 架构下刚好是相反的。</li>
</ol>
<h4>Double 类型的传递</h4>
<p>LS2C 在 64 位环境下的参数传递有 bug，浮点数无法正常处理。</p>
<p>bug 已经提交给 IBM 处理（更新：<a href="http://www-01.ibm.com/support/docview.wss?uid=swg21998636" target="_blank" rel="noopener">已确认不修复</a>），在解决前可以先把参数改为按引用传递（即使是只读的参数，也不按值传递）。</p>
<h4>资源的释放</h4>
<p>有一部分内存在 C 代码中分配后，后续会被 LotusScript 端继续使用。所以需要在 LotusScript 端不再使用的时候，手工释放这部分资源。</p>
<p>推荐的做法是把这类资源包装成 LotusScript Class，在 Delete 析构函数中释放资源。这样相当于 LotusScript 引擎会帮忙自动跟踪变量的引用，比较方便。</p>
<h4>调试共享库加载失败</h4>
<p>Domino 给出的错误信息很模糊：“dll 加载失败”，没有太多有用的信息。而错误背后可能的原因有很多：文件找不到、32/64 位不匹配、缺少依赖的库……</p>
<p>可以先通过其他语言（比如 LuaJIT）调用共享库，会得到更详细的错误信息。成功之后再放到 Domino 环境下调试。</p>
<h4>共享库的权限</h4>
<p>Linux、Aix 环境下要注意上传的 so 库必须要有运行权限。</p>
<h4>共享库的更新</h4>
<p>Linux、Aix 环境下 so 库更新的行为有些奇怪，有时候覆盖 so 文件后会导致 Domino 崩溃。看上去像是内存中保留了一部分旧版的代码，与新版搭配在一起就不行了。</p>
<p>所以更新共享库时要停掉Domino。</p>
<h3>总结</h3>
<p>虽然 LotusScript 已经步入晚年，但我们希望通过 LS2C 这种方式给它注入新的活力，在既有业务资产中继续发光发热。</p>
								</div>
			</article>
					<article itemscope itemtype="http://schema.org/Article" id="post-645321" class="post-645321 post type-post status-publish format-standard hentry category-dominonotes category-xpages tag-118">
	<header class="entry-header">
		<h2 class="entry-title" itemprop="name">
			<a itemprop="url" href="/articles/ibm-presents-the-ibm-notes-and-domino-roadmap.html" title="链向IBM 发布 Notes/Domino 发展路线图的固定链接" rel="bookmark">IBM 发布 Notes/Domino 发展路线图</a>
		</h2>
							<div class="entry-meta"><span class="entry-date"><a href="/articles/ibm-presents-the-ibm-notes-and-domino-roadmap.html" rel="bookmark"><time class="entry-date published" datetime="2016-11-07T11:40:35+08:00" itemprop="datepublished">2016年11月7日</time></a></span> by <span class="author vcard" itemscope itemprop="author" itemtype="http://schema.org/Person"><a class="url fn n" href="/articles/author/admin" rel="author" itemprop="url"><span itemprop="name">Sanmao</span></a></span><span class="sep">&middot;</span><span class="comments-link"><a href="/articles/ibm-presents-the-ibm-notes-and-domino-roadmap.html#comments" itemprop="discussionUrl">3条评论</a></span></div>
			</header>
								<div class="entry-content" itemprop="articleBody">
						<p>11月3日，IBM 发布了一个重要的信息：Notes/Domino 的发展路线图。原文件请<a href="http://www.slideshare.net/Teamstudio/ibm-presents-the-ibm-notes-and-domino-roadmap-68154347" target="_blank">点此查看</a>，以下是我个人的解读：</p>
<h3>Domino 又一次要死掉了？</h3>
<p>前些时间由于 902 版本的取消，Domino 社区里引起了很多讨论，很多人对 Domino 后续的发展持悲观态度（例如：<a title="There is no 9.0.2. Dead. Canceled. Killed. " href="https://blog.darrenduke.net/Darren/DDBZ.nsf/dx/there-is-no-9.0.2.-dead.-canceled.-killed.-.htm" target="_blank">There is no 9.0.2. Dead. Canceled. Killed. </a>）。</p>
<p>IBM 官方的回应是 901 版本的支持会延长到 2021 年，而且期间不仅是 bug fix，也包含新功能的增强，实际上的 902 版会以 901 feature pack 的形式发布。</p>
<h3>产品更新策略</h3>
<p>一个重要的变化，901 FP7 已经从 fix pack 转变为 <span style="color: #ff0000;">feature pack</span>，后续的所有新功能也都是以 FP 形式发布，所以才会有上文提及的取消 902 版本。</p>
<p>IBM 官方的说法是为了加快版本迭代速度，才引入了这个变化。其实这个行为也很好理解，类似于 Windows 10 的策略，似乎大家都不准备让产品的大版本号往前滚动了：毕竟升一个大版本要做很艰难的决定，小版本就简单多了不是么。</p>
<p>但是对于用户来讲，以前 FP 包发布后是可以无脑更新的，毕竟都是在改 bug；现在加入了新功能，是否要更新肯定就要打一个大大的问号了。</p>
<h3>支持的操作系统</h3>
<p>新的路线图中，将现有的操作系统分为两类：</p>
<ul>
<li>Win/RHEL：支持后续的 feature pack，有功能的持续改进</li>
<li>其他操作系统（AIX/IBM i）：仅有安全性更新、bug修复</li>
</ul>
<h3>Verse/iNotes</h3>
<p>Verse 的私有环境版（非云环境，Verse On-premises）将于 12 月发布。VOP 将替代现有的 iNotes，作为今后的新邮件客户端。</p>
<h3>Notes/Domino 后续新功能</h3>
<ul>
<li>Java 1.8 + OSGi/Eclipse 4.x</li>
</ul>
<p>祖传的 1.6 终于更新了，感动啊</p>
<ul>
<li>视图索引可移至 nsf 外部</li>
</ul>
<p>这个还是不错的，nsf 就应该存持久化的数据；索引这种缓存类数据分离出来后，更方便独立优化</p>
<ul>
<li>XPages</li>
</ul>
<p>持续更新，说起来 XPages 早就已经开始版本内的功能迭代了（853 Upgrade Pack 1）</p>
<h3>总结</h3>
<p>总体来说，Domino 肯定会继续发展和更新的。但是主要集中在 Java 端：VOP 基于 Connections、XPages。</p>
<p>啥时候把祖传的 NSF 存储也更新一下啊，万恶的 16K、32K 限制……</p>
								</div>
			</article>
					<article itemscope itemtype="http://schema.org/Article" id="post-645302" class="post-645302 post type-post status-publish format-standard hentry category-dominonotes tag-lotusscript tag-performance">
	<header class="entry-header">
		<h2 class="entry-title" itemprop="name">
			<a itemprop="url" href="/articles/lotusscript-timing-log.html" title="链向记录 Lotusscript 代码运行的时间的固定链接" rel="bookmark">记录 Lotusscript 代码运行的时间</a>
		</h2>
							<div class="entry-meta"><span class="entry-date"><a href="/articles/lotusscript-timing-log.html" rel="bookmark"><time class="entry-date published" datetime="2015-06-12T10:22:16+08:00" itemprop="datepublished">2015年06月12日</time></a></span> by <span class="author vcard" itemscope itemprop="author" itemtype="http://schema.org/Person"><a class="url fn n" href="/articles/author/admin" rel="author" itemprop="url"><span itemprop="name">Sanmao</span></a></span><span class="sep">&middot;</span><span class="comments-link"><a href="/articles/lotusscript-timing-log.html#comments" itemprop="discussionUrl">3条评论</a></span></div>
			</header>
								<div class="entry-content" itemprop="articleBody">
						<p>在分析 Lotusscript 性能时，我们经常需要找到耗时最长的瓶颈点，然后再进行针对性的优化。这时最常用的工具是<a href="/articles/domino7-new-feature-agent-profile.html" target="_blank">代理性能简要表</a>，但它有个限制是只能记录 Domino 相关对象方法的运行时间，比如 db.getView、view.getAllDocumentsByKey 等，对于原生 Lotusscript 的语句无法记录。</p>
<p>这时我们就需要将代码打成各个片段，记录每个片段的运行时间以缩小范围、进而定位到性能瓶颈的几条语句。但是 Lotusscript 中的 Now 只能精确到秒，显然是不够用的。还好通过 <a href="http://www-01.ibm.com/support/knowledgecenter/SSVRGU_8.5.3/com.ibm.designer.domino.main.doc/LSAZ_GETTHREADINFO.html?lang=de" target="_blank">getThreadInfo</a> 我们可以获取到毫秒级的时间值，具体代码如下：</p>
<blockquote><p>Dim startTic As Long<br />
Dim seconds As Double</p>
<p>startTic = Getthreadinfo(6)<br />
seconds = (Getthreadinfo(6) &#8211; startTic) / Getthreadinfo(7)</p>
<p>msgbox &#8220;Finished. The code ran for &#8221; &amp; seconds &amp; &#8221; seconds.&#8221;</p></blockquote>
								</div>
			</article>
					<article itemscope itemtype="http://schema.org/Article" id="post-645282" class="post-645282 post type-post status-publish format-standard hentry category-dominonotes">
	<header class="entry-header">
		<h2 class="entry-title" itemprop="name">
			<a itemprop="url" href="/articles/domino-datetime-in-hex-string.html" title="链向Domino日期时间的16进制表示法的固定链接" rel="bookmark">Domino日期时间的16进制表示法</a>
		</h2>
							<div class="entry-meta"><span class="entry-date"><a href="/articles/domino-datetime-in-hex-string.html" rel="bookmark"><time class="entry-date published" datetime="2015-01-27T15:17:37+08:00" itemprop="datepublished">2015年01月27日</time></a></span> by <span class="author vcard" itemscope itemprop="author" itemtype="http://schema.org/Person"><a class="url fn n" href="/articles/author/admin" rel="author" itemprop="url"><span itemprop="name">Sanmao</span></a></span><span class="sep">&middot;</span><span class="comments-link"><a href="/articles/domino-datetime-in-hex-string.html#respond" itemprop="discussionUrl">0评论</a></span></div>
			</header>
								<div class="entry-content" itemprop="articleBody">
						<p><a title="链接到 Domino 环境中各种 ID 的介绍" href="/articles/various-ids-in-domino.html" target="_blank">Domino 环境中各种 ID 的介绍</a>这篇文章中我介绍过，NSF 的副本 ID 实际上就是库的创建时间，文档 UNID 的后半部分也是文档的创建时间。我们来看看样例：</p>
<blockquote><p>副本标识符：<strong>48257BA6</strong>:<strong>033771DF</strong></p>
<p>文档UNID：9CC4EF2FC8A16397<strong>48257CB40036EBE6</strong></p></blockquote>
<p>看上去粗体的部分是很类似，只不过和时间看不出太大联系，应该是编码过了。</p>
<p>再看两个 Domino 自带数据库的文档样例。第一个是管理请求文档：</p>
<p><a href="/wp-content/uploads/2015/01/domino-hex-time-1.png"><img class="aligncenter size-medium wp-image-645283" src="/wp-content/uploads/2015/01/domino-hex-time-1-300x153.png" alt="domino-hex-time-1" width="300" height="153" srcset="/wp-content/uploads/2015/01/domino-hex-time-1-300x153.png 300w, /wp-content/uploads/2015/01/domino-hex-time-1.png 370w" sizes="(max-width: 300px) 100vw, 300px" /></a>第二个是 Catalog 文档：</p>
<p><a href="/wp-content/uploads/2015/01/domino-hex-time-2.png"><img class="aligncenter size-medium wp-image-645284" src="/wp-content/uploads/2015/01/domino-hex-time-2-300x154.png" alt="domino-hex-time-2" width="300" height="154" srcset="/wp-content/uploads/2015/01/domino-hex-time-2-300x154.png 300w, /wp-content/uploads/2015/01/domino-hex-time-2.png 369w" sizes="(max-width: 300px) 100vw, 300px" /></a>这两个文档存储的都是数据库副本 ID，但从右边的结果上看实际存储的都是时间值。看上去日期/时间和副本 ID 的 16 进制数应该是可以互相转换的。通过查看相关视图设计，我们发现一个文档中没有的公式函数：</p>
<blockquote><p><span style="font-family: sans-serif; font-size: small;">@Text(&#8220;ProxyReplicaID&#8221;; &#8220;*&#8221;)</span></p></blockquote>
<p>通过 @Text 的”*“参数，可以将一个时间值转换为对应的字符串。对应的，通过以下 Lotusscript 代码可以反过来转换：</p>
<blockquote><p><span style="font-family: sans-serif; font-size: small;">Dim replicaTD as New NotesDateTime(dbTarget.ReplicaID)</span></p></blockquote>
<p>参考文档：<br />
<a title="Creating a replica ID item for adminp requests" href="http://www-10.lotus.com/ldd/bpmpblog.nsf/dx/creating-a-replica-id-item-for-adminp-requests" target="_blank" rel="bookmark">Creating a replica ID item for adminp requests</a>，<a href="http://www-01.ibm.com/support/docview.wss?uid=swg27003019" target="_blank">How to interpret the Hexadecimal values in a Time/Date value</a></p>
								</div>
			</article>
					<article itemscope itemtype="http://schema.org/Article" id="post-645270" class="post-645270 post type-post status-publish format-standard hentry category-dominonotes tag-conflict">
	<header class="entry-header">
		<h2 class="entry-title" itemprop="name">
			<a itemprop="url" href="/articles/save-conflict.html" title="链向保存冲突的那些事儿的固定链接" rel="bookmark">保存冲突的那些事儿</a>
		</h2>
							<div class="entry-meta"><span class="entry-date"><a href="/articles/save-conflict.html" rel="bookmark"><time class="entry-date published" datetime="2014-12-31T16:39:19+08:00" itemprop="datepublished">2014年12月31日</time></a></span> by <span class="author vcard" itemscope itemprop="author" itemtype="http://schema.org/Person"><a class="url fn n" href="/articles/author/admin" rel="author" itemprop="url"><span itemprop="name">Sanmao</span></a></span><span class="sep">&middot;</span><span class="comments-link"><a href="/articles/save-conflict.html#comments" itemprop="discussionUrl">2条评论</a></span></div>
			</header>
								<div class="entry-content" itemprop="articleBody">
						<p>几年前，我写过一篇关于<a href="/articles/behind-the-scenes-of-replication-conflict.html" target="_blank">复制冲突</a>的文章，今天来聊聊它的小兄弟：保存冲突。</p>
<p>从名字上就能看出来，复制冲突是在两台服务器上修改同一个文档后产生的，而保存冲突则是在同一台服务器上修改同一个文档后产生的。</p>
<p>在 web 应用中修改一个文档，主要有两种方式：</p>
<ol>
<li>以 ?EditDocument URL 命令打开文档，然后调用 form.submit() 保存当前文档</li>
<li>通过代理等后台代码的方式修改并保存文档</li>
</ol>
<p>以下图的时间线场景为例：</p>
<p><img class="aligncenter" src="/pic/save-conflict-1.png" alt="" width="493" height="151" /></p>
<p>由于代理的运行时间一般很短， 3、4 两个代理在时间线上可以考虑为点，所以理论上他们之间的时间是不会有交叉的，也就是两个代理保存同一个文档一般不会出现保存冲突</p>
<p>通过 ?EditDocument 方式一般持续时间较长，从打开文档到点击保存按钮这一段时间都是其处理时间，这期间出现保存冲突的可能性很大。例如：在用户A编辑期间，代理C保存了同一条文档，那么用户A点击保存按钮的时候，就会产生冲突文档。同样的，用户B编辑期间，用户A通过用户A点击保存按钮修改了同一条文档，用户B点击保存按钮的时候，就会产生冲突文档。</p>
<p>那么如何避免保存冲突的产生呢？NotesDocument.lock 方法就是针对这个问题的，但是很遗憾此方法在 web 端无法使用。所以我们需要自己实现一个文档锁的逻辑：每次进入编辑状态时加锁，离开编辑状态后解锁；未取得的锁的情况下不允许进入编辑状态。这样就能保证同时只有一人编辑文档，避免了保存冲突的产生。这里有一个思路供参考：<a href="http://www.wissel.net/blog/d6plinks/SHWL-7UVGSE" target="_blank">Distributed Document Locking Web Style</a> 。</p>
<p>再回到上面的一个问题，代理的运行时间短，一般不会导致冲突文档。如果代理的运行时间很长呢，两个代理保存同一个文档会不会产生冲突文档？为此我写了如下代码做测试：</p>
<blockquote><p>Sub Initialize<br />
Dim s As New NotesSession<br />
Dim db As NotesDatabase<br />
Dim doc As NotesDocument<br />
MsgBox &#8220;agent start&#8221;<br />
Set db = s.Currentdatabase<br />
Set doc = db.Getdocumentbyunid(&#8220;FC71D0667744C41D48257D6C0011AB7F&#8221;)<br />
Dim count As Integer<br />
count  = doc.count(0)<br />
MsgBox count<br />
Sleep(5)<br />
doc.count = count + 1<br />
doc.agentname = &#8220;1&#8221;<br />
MsgBox doc.save(true,true)<br />
MsgBox &#8220;agent end&#8221;<br />
End Sub</p></blockquote>
<p>为了拉长运行时间，我在中间加了 Sleep(5)。连续运行两次代理，测试结果如下：</p>
<ul>
<li>doc.save(false,false)：后一次保存失败，文档未保存，返回值为 false</li>
<li>doc.save(false,true)：后一次保存为前一次的答复文档（注意不是冲突文档），返回值为 true</li>
<li>doc.save(true,true)：后一次保存覆盖前一次保存的内容，前一次的内容丢失，返回值为 true（第二个参数随便传true/false，没有影响）</li>
</ul>
<p>总结一下：web 端通过 ?EditDocument 方式编辑文档时，很容易出现保存冲突，注意用文档那个锁的方式来避免；代理保存文档时，一般不会出现冲突，但如果 getDocument 至 doc.save 之间的代码逻辑很复杂、运行时间长，也要注意处理数据覆盖的问题。</p>
<p>今天是 2014 年的最后一天了，祝大家新年快乐！保存冲突系列还有一篇没写完，明年继续。</p>
<p>Edit：经测试发现，如果用户A和代理C是以同一个用户身份保存的，那么不会有冲突文档，结果是后保存的覆盖之前的。（这样也合理，同一个用户间的数据覆盖没问题，不同用户间就要保留两份文档，供管理员后续合并冲突文档时参考）</p>
<p><img class="aligncenter" src="/pic/save-conflict-1.png" alt="" width="493" height="151" /></p>
								</div>
			</article>
					<article itemscope itemtype="http://schema.org/Article" id="post-645259" class="post-645259 post type-post status-publish format-standard hentry category-dominonotes category-ubuntulinux tag-dbcache">
	<header class="entry-header">
		<h2 class="entry-title" itemprop="name">
			<a itemprop="url" href="/articles/session-getdatabase-case-sensitive.html" title="链向session.getDatabase 中文件名大小写的问题的固定链接" rel="bookmark">session.getDatabase 中文件名大小写的问题</a>
		</h2>
							<div class="entry-meta"><span class="entry-date"><a href="/articles/session-getdatabase-case-sensitive.html" rel="bookmark"><time class="entry-date published" datetime="2014-09-15T18:03:17+08:00" itemprop="datepublished">2014年09月15日</time></a></span> by <span class="author vcard" itemscope itemprop="author" itemtype="http://schema.org/Person"><a class="url fn n" href="/articles/author/admin" rel="author" itemprop="url"><span itemprop="name">Sanmao</span></a></span><span class="sep">&middot;</span><span class="comments-link"><a href="/articles/session-getdatabase-case-sensitive.html#respond" itemprop="discussionUrl">0评论</a></span></div>
			</header>
								<div class="entry-content" itemprop="articleBody">
						<p>最近在项目上遇到了一个奇怪的问题：某个 XPages 页面偶发性报错，对数据库进行签名后问题消失，但过些时间就又会出现。</p>
<p>由于签名后问题消失，最开始排查时就认为是代码签名的问题，可能是服务器上有对应的模板，设计不定时的被 Design 任务刷新回来导致问题。但是通过各种方法找了很多遍，都确认库的设计没有被刷新过。</p>
<p>最终通过检查代码的错误行发现，是一处 session.getDatabase 调用时数据库路径的大小写有问题，修改成与文件系统一致后问题消失。问题虽然解决了，但为什么同样的代码大部分情况下没问题，只有偶发性的报错呢？同样的代码在同为 Linux 平台的产品测试环境上，为什么就一切正常呢？</p>
<p>带着这些疑问继续探索，终于找到了一些端倪。在这个<a href="http://www-01.ibm.com/support/docview.wss?uid=swg1LO58955" target="_blank">技术文档</a>中提到如下内容：</p>
<blockquote><p>DB on server names AgentRunner.nsf. Notes the upper/lowercase.</p>
<p>Steps to Reproduce:</p>
<p>After a server restart or a &#8220;dbcache flush&#8221;:</p>
<p>&gt; lo fixup agentrunner<br />
&gt; 25.06.2002 09:58:00   Database fixup process started<br />
25.06.2002 09:58:00   Unable to fixup database agentrunner: File<br />
does not exist<br />
25.06.2002 09:58:00   Database fixup process shutdown<br />
&#8211;&gt; <span style="color: #ff0000;">does not work, because db is not in server cache</span></p>
<p>lo fixup AgentRunner<br />
&gt; 25.06.2002 09:58:07   Database fixup process started<br />
25.06.2002 09:58:07   Performing consistency check on<br />
AgentRunner.nsf&#8230;<br />
25.06.2002 09:58:08   Completed consistency check on<br />
AgentRunner.nsf<br />
25.06.2002 09:58:08   Database fixup process shutdown<br />
&#8211;&gt; <span style="color: #ff0000;">works &#8211; it`s exact-case</span></p>
<p>&gt; lo fixup agentrunner<br />
&gt; 25.06.2002 09:58:12   Database fixup process started<br />
25.06.2002 09:58:12   Database fixup process shutdown<br />
&#8211;&gt; <span style="color: #ff0000;">works now with lowercase, cause db is in cache</span></p>
<p>dbcache flush<br />
&gt; lo fixup agentrunner<br />
&gt; 25.06.2002 09:58:21   Database fixup process started<br />
25.06.2002 09:58:21   Unable to fixup database agentrunner: File<br />
does not exist<br />
25.06.2002 09:58:21   Database fixup process shutdown<br />
&#8211;&gt; <span style="color: #ff0000;">db removed from cache &#8211;&gt; doesn`t work</span></p></blockquote>
<p>整个过程总结如下：</p>
<ul>
<li>首先用大小写错误的文件名访问，报错</li>
<li>再用大小写正确的文件名访问，正常</li>
<li>再次用大小写错误的文件名访问，正常（因为上一条命令已经将数据库加入了 dbcache）</li>
<li>清空 dbcache 后，再次用大小写错误的文件名访问，报错</li>
</ul>
<p>导致这个现象的根本原因就是：</p>
<ul>
<li>当数据库不在 dbcache 中时，Domino 使用数据库文件名通过文件系统获取数据库对象，此时是区分大小写的</li>
<li>当数据库在 dbcache 中时，Domino 使用数据库文件名在 dbcache 中查找，找到后直接返回数据库对象，此过程无需访问文件系统，所以就不区分大小写</li>
</ul>
<p>分析到这里，最初的所有现象就能说通了：</p>
<ul>
<li>错误偶发，是因为大部分情况下此库都在 dbcache 中，可能只有服务器刚刚启动/缓存超限将此库移除时，才会报错</li>
<li>签名后错误消失，是因为签名的过程肯定会把此库加入到 dbcache</li>
</ul>
<p>吃一堑长一智，既然这个问题让我纠结了这么久，那么如何才能避免此类问题发生呢？建议如下：</p>
<ul>
<li>数据库名始终使用全小写，代码中获取数据库时也用全小写</li>
<li>*nux 测试环境下建议通过 NSF_DbCache_Disable=1 禁用缓存。虽然性能会差一些，但是能尽早的发现问题（千万别在生产服务器上这样做）</li>
</ul>
								</div>
			</article>
					<article itemscope itemtype="http://schema.org/Article" id="post-645249" class="post-645249 post type-post status-publish format-standard hentry category-dominonotes tag-lotusscript tag-webservice">
	<header class="entry-header">
		<h2 class="entry-title" itemprop="name">
			<a itemprop="url" href="/articles/porttype-class-error-on-save-webservice.html" title="链向webservice 保存时报&#8217;PortType class&#8217;未指定的错误的固定链接" rel="bookmark">webservice 保存时报&#8217;PortType class&#8217;未指定的错误</a>
		</h2>
							<div class="entry-meta"><span class="entry-date"><a href="/articles/porttype-class-error-on-save-webservice.html" rel="bookmark"><time class="entry-date published" datetime="2014-07-11T11:16:21+08:00" itemprop="datepublished">2014年07月11日</time></a></span> by <span class="author vcard" itemscope itemprop="author" itemtype="http://schema.org/Person"><a class="url fn n" href="/articles/author/admin" rel="author" itemprop="url"><span itemprop="name">Sanmao</span></a></span><span class="sep">&middot;</span><span class="comments-link"><a href="/articles/porttype-class-error-on-save-webservice.html#respond" itemprop="discussionUrl">0评论</a></span></div>
			</header>
								<div class="entry-content" itemprop="articleBody">
						<p>在使用 Lotusscript 开发 webservice 的过程中，有时会提示以下错误信息：</p>
<blockquote><p>Web Service 已经保存，但是无效。: Please specify which class exposes your web service interface(s), using the &#8216;PortType class&#8217; field of the Web Service properties panel.</p></blockquote>
<p>按照提示排查，发现在属性框中&#8217;PortType class&#8217;已经指定了对应的类名。既然不是这里的问题，那只能回头看代码了：</p>
<blockquote><p>Class Test<br />
Sub printDoc(doc As NotesDocument)</p>
<p>End Sub<br />
End Class</p></blockquote>
<p>代码足够简单：仅有一个空白方法的 Class。</p>
<p>这个方法没有声明权限，按帮助中说的默认是 Public。那么此方法就会暴露到 WSDL 中，可以通过 webservice 调用。</p>
<p>问题出来了：通过 webservice 调用时如何能传进来一个 NotesDocument 对象呢？这显然是不可能的。赶紧把方法改成 Private 或者把 doc 参数改为 String 类型，问题就解决了。</p>
<p>总结：暴露给 webservice 的方法/函数，不能以 Domino 对象作为参数。</p>
								</div>
			</article>
					<article itemscope itemtype="http://schema.org/Article" id="post-645228" class="post-645228 post type-post status-publish format-standard hentry category-dominonotes">
	<header class="entry-header">
		<h2 class="entry-title" itemprop="name">
			<a itemprop="url" href="/articles/relational-operators-are-not-supported-in-text-fields.html" title="链向全文搜索时报错：文本域不支持关系运算符的固定链接" rel="bookmark">全文搜索时报错：文本域不支持关系运算符</a>
		</h2>
							<div class="entry-meta"><span class="entry-date"><a href="/articles/relational-operators-are-not-supported-in-text-fields.html" rel="bookmark"><time class="entry-date published" datetime="2013-11-15T17:18:05+08:00" itemprop="datepublished">2013年11月15日</time></a></span> by <span class="author vcard" itemscope itemprop="author" itemtype="http://schema.org/Person"><a class="url fn n" href="/articles/author/admin" rel="author" itemprop="url"><span itemprop="name">Sanmao</span></a></span><span class="sep">&middot;</span><span class="comments-link"><a href="/articles/relational-operators-are-not-supported-in-text-fields.html#respond" itemprop="discussionUrl">0评论</a></span></div>
			</header>
								<div class="entry-content" itemprop="articleBody">
						<p>在对时间、数值域进行全文搜索的时候，如果使用了&gt;、&lt;等关系运算符，有时会报如下错误：</p>
<blockquote><p>文本域不支持关系运算符</p></blockquote>
<p>去文档域中查看一下，明明是日期域，怎么提示的却是文本域呢？</p>
<p>问题是这样的：在 nsf 中，有一个叫 UNK 表（可以用 notespeek 查看，在 Item Def Table 中）的东西，保存了数据库中所有字段的类型。当包含某个字段的第一个文档添加到库时，会写入 UNK 表。所以如果之前在数据库中曾经出现过同名的文本字段，那么这个 UNK 表中记录的就是文本型，所以会报前面说的错误。</p>
<p>原因搞清楚了，想要解决就简单了：</p>
<ol>
<li>清除所有非日期型的同名字段</li>
<li>删除全文索引</li>
<li>压缩数据库，此时会重建 UNK 表（我测试时需要 compact -c 才行）</li>
<li>重建全文索引</li>
</ol>
<p>参考资料：<a href="https://www-304.ibm.com/support/docview.wss?uid=swg21261002" target="_blank">Searching on a field in Notes fails when indexer does not recognize field data type</a></p>
								</div>
			</article>
					<article itemscope itemtype="http://schema.org/Article" id="post-645224" class="post-645224 post type-post status-publish format-standard hentry category-1 tag-nd9">
	<header class="entry-header">
		<h2 class="entry-title" itemprop="name">
			<a itemprop="url" href="/articles/notesdomino-901-available.html" title="链向Notes/Domino 9.0.1 英文版已发布的固定链接" rel="bookmark">Notes/Domino 9.0.1 英文版已发布</a>
		</h2>
							<div class="entry-meta"><span class="entry-date"><a href="/articles/notesdomino-901-available.html" rel="bookmark"><time class="entry-date published" datetime="2013-10-30T10:17:28+08:00" itemprop="datepublished">2013年10月30日</time></a></span> by <span class="author vcard" itemscope itemprop="author" itemtype="http://schema.org/Person"><a class="url fn n" href="/articles/author/admin" rel="author" itemprop="url"><span itemprop="name">Sanmao</span></a></span><span class="sep">&middot;</span><span class="comments-link"><a href="/articles/notesdomino-901-available.html#comments" itemprop="discussionUrl">2条评论</a></span></div>
			</header>
								<div class="entry-content" itemprop="articleBody">
						<p>Notes/Domino 9.0.1 英文版已发布，这是一个bug修正版本，推荐更新。按照惯例中文版估计一个月后也就能发布了。</p>
<p>完整的新功能列表请参考：<a href="http://www-10.lotus.com/ldd/fixlist.nsf/8d1c0550e6242b69852570c900549a74/de0329821264ceff85257c130056adda?OpenDocument" target="_blank">修复bug列表</a>、<a href="http://www-01.ibm.com/common/ssi/ShowDoc.wss?docURL=/common/ssi/rep_ca/1/897/ENUS213-481/index.html&amp;lang=en&amp;request_locale=en" target="_blank">IBM US Announcement Letter</a></p>
								</div>
			</article>
					<article itemscope itemtype="http://schema.org/Article" id="post-645211" class="post-645211 post type-post status-publish format-standard hentry category-dominonotes">
	<header class="entry-header">
		<h2 class="entry-title" itemprop="name">
			<a itemprop="url" href="/articles/unknown-os-error.html" title="链向Unknown OS error的固定链接" rel="bookmark">Unknown OS error</a>
		</h2>
							<div class="entry-meta"><span class="entry-date"><a href="/articles/unknown-os-error.html" rel="bookmark"><time class="entry-date published" datetime="2013-05-08T14:01:18+08:00" itemprop="datepublished">2013年05月8日</time></a></span> by <span class="author vcard" itemscope itemprop="author" itemtype="http://schema.org/Person"><a class="url fn n" href="/articles/author/admin" rel="author" itemprop="url"><span itemprop="name">Sanmao</span></a></span><span class="sep">&middot;</span><span class="comments-link"><a href="/articles/unknown-os-error.html#comments" itemprop="discussionUrl">一条评论</a></span></div>
			</header>
								<div class="entry-content" itemprop="articleBody">
						<p>通过 web 方式访问某个数据库时，Domino 报如下错误：</p>
<blockquote><p>Error 500: Unknown OS error.</p></blockquote>
<p>解决方法如下：</p>
<ul>
<li>集群环境：在 admin 端找到问题数据库，右键&gt;集群&#8230;&gt;集群可用性状态 选择 “使用中”&gt;确定</li>
<li>非集群环境：将问题库新建拷贝/新建副本 即可</li>
</ul>
<p>IBM的<a href="http://www-01.ibm.com/support/docview.wss?uid=swg21207310" target="_blank">技术支持文档</a>，描述了此问题的解决方案，但并未说明是如何导致的。</p>
								</div>
			</article>
				
	<nav class="navigation pagination" role="navigation">
		<h2 class="screen-reader-text">文章导航</h2>
		<div class="nav-links"><span aria-current='page' class='page-numbers current'>1</span>
<a class='page-numbers' href='/page/2'>2</a>
<span class="page-numbers dots">&hellip;</span>
<a class='page-numbers' href='/page/19'>19</a>
<a class="next page-numbers" href="/page/2"><i class="fa fa-chevron-right"></i></a></div>
	</nav>	
			</div>
												<footer class="site-info" itemscope itemtype="http://schema.org/WPFooter">
										<a href="http://cn.wordpress.org/" title="优雅的个人发布平台">由WordPress自豪地提供</a>.
					主题：Flat 1.0.4 by <a rel="nofollow" href="https://themeisle.com/themes/flat/" title="Flat WordPress Theme">Themeisle</a>				</footer>
														</div>
					</div>
	</div>
</div>
<!-- Powered by WPtouch: 4.3.37 --><script src='/wp-includes/js/wp-embed.min.js?ver=5.2.2'></script>
</body>
</html>
